global:
  scrape_interval: 15s      # Default scrape interval for all jobs
  evaluation_interval: 15s  # How often to evaluate alerting rules
  external_labels:
    cluster: 'unified-visibility-platform'
    environment: 'development'

# Alertmanager configuration (to be added when Alertmanager is set up)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Load rules once and periodically evaluate them
rule_files:
  # - "rules/*.yml"  # Uncomment when you have alerting rules

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    scrape_interval: 15s
    scrape_timeout: 10s
    static_configs:
      - targets: ['localhost:9090']
        labels:
          component: 'monitoring'
          service: 'prometheus'

  # Backend API metrics - PRIMARY CONFIGURATION
  # This scrapes metrics from your unified visibility platform API
  - job_name: 'backend-api'
    scrape_interval: 15s      # Scrape every 15 seconds
    scrape_timeout: 10s       # Timeout after 10 seconds
    metrics_path: '/metrics'  # Path where your API exposes Prometheus metrics
    static_configs:
      - targets: ['backend:8000']  # Use Docker service name in docker-compose network
        labels:
          service: 'unified-visibility-api'
          component: 'backend'
          environment: 'development'
    # Optional: Add relabeling for better metric organization
    relabel_configs:
      # Add instance label for better identification
      - source_labels: [__address__]
        target_label: instance
        replacement: 'backend-api:8000'
      # Add scrape job label
      - target_label: job
        replacement: 'backend-api'
    
    # Uncomment if your API requires authentication:
    # Option 1: Basic Authentication
    # basic_auth:
    #   username: '${PROMETHEUS_USER}'
    #   password: '${PROMETHEUS_PASSWORD}'
    
    # Option 2: Bearer Token (recommended for production)
    # bearer_token: 'your-bearer-token-here'
    # Or use a token file:
    # bearer_token_file: '/etc/prometheus/api-token'
    
    # Option 3: TLS/HTTPS (if your API uses HTTPS)
    # scheme: https
    # tls_config:
    #   insecure_skip_verify: false
    #   cert_file: '/etc/prometheus/client.crt'
    #   key_file: '/etc/prometheus/client.key'
    #   ca_file: '/etc/prometheus/ca.crt'

  # Optional: Multiple backend instances (for load-balanced/scaled deployments)
  # Uncomment and configure when you have multiple API instances
  # - job_name: 'backend-api-cluster'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   metrics_path: '/metrics'
  #   static_configs:
  #     - targets:
  #         - 'backend-1:8000'
  #         - 'backend-2:8000'
  #         - 'backend-3:8000'
  #       labels:
  #         service: 'unified-visibility-api'
  #         component: 'backend'
  #         environment: 'production'
  #   relabel_configs:
  #     - source_labels: [__address__]
  #       regex: '([^:]+):.*'
  #       target_label: instance
  #       replacement: '${1}'

  # Optional: Node Exporter for system metrics (CPU, memory, disk, etc.)
  # Uncomment if you want to monitor the host system
  # - job_name: 'node-exporter'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   static_configs:
  #     - targets: ['node-exporter:9100']
  #       labels:
  #         component: 'infrastructure'
  #         service: 'node-exporter'

  # Optional: Pushgateway (for short-lived jobs or batch processes)
  # Uncomment if you set up Pushgateway in docker-compose.yml
  # - job_name: 'pushgateway'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   honor_labels: true  # Important: use labels from pushgateway
  #   static_configs:
  #     - targets: ['pushgateway:9091']
  #       labels:
  #         component: 'monitoring'
  #         service: 'pushgateway'

  # Optional: cAdvisor for container metrics (if using Docker)
  # - job_name: 'cadvisor'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   static_configs:
  #     - targets: ['cadvisor:8080']
  #       labels:
  #         component: 'infrastructure'
  #         service: 'cadvisor'